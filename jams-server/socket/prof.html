<!doctype html>
<html>
    <head>
        <script src="/socket.io/socket.io.js"></script>
        <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
        
        
        <title>Chat Anti-Caroline</title>
        <style>
            #messages li:nth-child(odd) {background: #eee;}
            body {font-size: 24px;}
            #texteenvoi {bottom:0; width:100%;font-size: inherit;}
            form button{font-size: inherit;}
        </style>
    </head>
    <body>
        <div >
			<div id="eleves">Eleves : 0</div>
			<div id="reponses">Réponses : 0</div>
            <ul id="messages">
            </ul>
			<select>
			  <option value="volvo">Volvo</option>
			  <option value="saab">Saab</option>
			  <option value="mercedes">Mercedes</option>
			  <option value="audi">Audi</option>
			</select>
            <form id="chat">
                <button type="submit">Envoi</button>
            </form>
        </div>
        
        <script>
			var url = window.location.href;
			url = url.split("/");
			var chatId = url[url.length-1];
			//alert(chatId);
			var indexQuestion=0;
			
            $("#texteenvoi").focus();
            
            /* global io */
            var socket = io();
            
			//fonction permettant l'ajoute d'un message dans la balise "ul"
            function add_message(msg,id) {
				if (id == chatId){
					$('#messages').append("<li>"+msg+"</li>");
				}
            }
			function modifyNumberEleve(numEleves)
			{
				document.getElementById("eleves").innerHTML = "Eleves : "+numEleves;
			}

			//Cette ligne permet d'executer la fonction add_message si "chat message" est recu par le socket
            socket.on('chat message', add_message);
			socket.on('nouvel eleve', function(){
				
			});
			socket.on('reponses', function(reponses){
				document.getElementById("reponses").innerHTML = "Réponses : "+reponses;
			});
			socket.on('user joined', function(data){
				modifyNumberEleve(data.numEleves);
			});
			socket.on('user left', function(data){
				modifyNumberEleve(data.numEleves);
			});

            $('#chat').submit(function(){
				if(indexQuestion==0)
				{
				    console.log("start");
					socket.emit('start', {
					    numero : indexQuestion+1,
						question : "premiere question",
						reponses : ["r1","r2","r3"],
						bonneReponse : 1
					});
					indexQuestion++;
				}
				else if(indexQuestion==2){
                    socket.emit('finish');
                }
				else
				{
					socket.emit('next', {
					    numero : indexQuestion+1,
						question : "suivant question",
						reponses : ["re1","re2","re3"],
						bonneReponse : 2
					});
					indexQuestion++;
				}
                //socket.emit('chat message', $('#texteenvoi').val(),chatId);
                //$('#texteenvoi').val("");
                
                // return false évite que le navigateur recharge
                // la page à chaque envoi du formulaire
                return false;
                });
        </script>

    </body>
</html>